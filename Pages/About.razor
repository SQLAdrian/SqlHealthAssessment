<!--/* In the name of God, the Merciful, the Compassionate */-->
@page "/about"

@inject NavigationManager Navigation
@inject AutoUpdateService UpdateService

<div class="about-container">
    <h1>About SQL Health Assessment</h1>
    
    <div class="about-section">
        <h2>üìñ Overview</h2>
        <p>
            <strong>SQL Health Assessment</strong> is an enterprise-grade SQL Server monitoring and health assessment tool 
            built with .NET 8, WPF, and Blazor. It provides real-time monitoring, comprehensive health checks, 
            and performance analysis for multiple SQL Server instances.
        </p>
        <p>
            <strong>Version:</strong> @UpdateService.GetCurrentVersion() | 
            <strong>Build:</strong> Self-Contained Optimized | 
            <strong>Size:</strong> ~100-120 MB
        </p>
    </div>

    <div class="about-section">
        <h2>‚ú® Enterprise Features</h2>
        <div class="features-grid">
            <div class="feature-card">
                <h3>üîí Security</h3>
                <ul>
                    <li>DPAPI credential encryption</li>
                    <li>SQL injection prevention</li>
                    <li>Comprehensive audit logging</li>
                    <li>Security event tracking</li>
                </ul>
            </div>
            <div class="feature-card">
                <h3>‚ö° Performance</h3>
                <ul>
                    <li>Configurable query timeouts (60s)</li>
                    <li>Memory pressure monitoring</li>
                    <li>Automatic cache eviction</li>
                    <li>SQLite caching layer</li>
                </ul>
            </div>
            <div class="feature-card">
                <h3>üìä Observability</h3>
                <ul>
                    <li>Serilog structured logging</li>
                    <li>Query execution tracking</li>
                    <li>Performance metrics</li>
                    <li>30-day log retention</li>
                </ul>
            </div>
            <div class="feature-card">
                <h3>üé® User Experience</h3>
                <ul>
                    <li>Toast notifications</li>
                    <li>Keyboard shortcuts (Ctrl+1-9)</li>
                    <li>WCAG 2.1 AA accessibility</li>
                    <li>10 theme options</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="about-section">
        <h2>üöÄ Deploying SQLWatch Database</h2>
        
        <h3>Option 1: Deploy via Application (Recommended)</h3>
        <ol>
            <li>Go to <strong>Monitoring new server</strong> from the navigation menu</li>
            <li>Enter your SQL Server connection details (server name, authentication method)</li>
            <li>Select the database name (default: SQLWATCH)</li>
            <li>Click <strong>Deploy</strong> - the application will create the database and tables automatically</li>
            <li>Once deployed, the server will appear in your servers list</li>
        </ol>

        <h3>Option 2: Manual Deployment</h3>
        <ol>
            <li>Locate the SQLWATCH deployment scripts in the application directory</li>
            <li>Run <code>01_CreateSQLWATCHDB.sql</code> to create the database and tables</li>
            <li>Run <code>02_PostSQLWATCHDBcreate.sql</code> to add post-creation objects</li>
            <li>Configure SQL Agent jobs for data collection (optional)</li>
        </ol>

        <div class="alert alert-info">
            <strong>Note:</strong> The application requires at least SQL Server 2016 or later for full functionality.
        </div>

        <h3>üîê Trust Server Certificate Option</h3>
        <p>
            If you encounter SSL/TLS connection errors when deploying to a SQL Server with encryption enabled,
            you can enable the <strong>Trust Server Certificate</strong> option:
        </p>
        <ul>
            <li><strong>Via Application Settings</strong>: Go to Settings and enable "Trust Server Certificate"</li>
            <li><strong>For New Servers</strong>: When adding a server in the Servers page, check "Trust Server Certificate"</li>
            <li><strong>Connection String</strong>: Add <code>TrustServerCertificate=True</code> to your connection string</li>
        </ul>
        <div class="alert alert-warning">
            <strong>Security Note:</strong> Only enable Trust Server Certificate in trusted environments.
            In production, ensure the SQL Server has a valid SSL certificate installed.
        </div>
    </div>

    <div class="about-section">
        <h2>‚ö° Running Quick Checks</h2>
        
        <h3>Quick Check (Ctrl+0)</h3>
        <p>
            The Quick Check page provides instant health assessment of your SQL Server instance:
        </p>
        <ul>
            <li><strong>CPU Usage</strong> - Current CPU utilization</li>
            <li><strong>Memory Pressure</strong> - Memory usage analysis</li>
            <li><strong>Active Sessions</strong> - Currently running queries</li>
            <li><strong>Blocking Queries</strong> - Identify blocked processes</li>
            <li><strong>Index Health</strong> - Missing and unused indexes</li>
        </ul>
        
        <h3>Full Audit</h3>
        <p>
            For comprehensive analysis, use the Full Audit page which performs:
        </p>
        <ul>
            <li>Configuration review</li>
            <li>Performance baseline analysis</li>
            <li>Security assessment</li>
            <li>Backup verification</li>
            <li>Index fragmentation analysis</li>
        </ul>
    </div>

    <div class="about-section">
        <h2>üìä Available Dashboards</h2>
        
        <table class="dashboards-table">
            <thead>
                <tr>
                    <th>Dashboard</th>
                    <th>Description</th>
                    <th>Shortcut</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Repository</td>
                    <td>Overview of all monitored servers</td>
                    <td>Ctrl+1</td>
                </tr>
                <tr>
                    <td>Instance Overview</td>
                    <td>Detailed metrics for selected instance</td>
                    <td>Ctrl+2</td>
                </tr>
                <tr>
                    <td>Long Queries</td>
                    <td>Queries running longer than threshold</td>
                    <td>-</td>
                </tr>
                <tr>
                    <td>Wait Events</td>
                    <td>SQL Server wait statistics</td>
                    <td>-</td>
                </tr>
                <tr>
                    <td>Blocking Queries</td>
                    <td>Current blocking chains</td>
                    <td>-</td>
                </tr>
                <tr>
                    <td>Checks</td>
                    <td>Health check results</td>
                    <td>Ctrl+3</td>
                </tr>
                <tr>
                    <td>Quick Check</td>
                    <td>Fast health assessment</td>
                    <td>Ctrl+0</td>
                </tr>
                <tr>
                    <td>Full Audit</td>
                    <td>Comprehensive audit</td>
                    <td>Ctrl+4</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="about-section">
        <h2>‚ùì Frequently Asked Questions</h2>
        
        <details>
            <summary><strong>Q: How do I add a new SQL Server to monitor?</strong></summary>
            <p>
                Go to <strong>Servers</strong> page (Ctrl+8), click <strong>Add Server</strong>, 
                enter the connection details, and click Save. You can then deploy the SQLWatch 
                database to start monitoring.
            </p>
        </details>
        
        <details>
            <summary><strong>Q: What permissions does the monitoring user need?</strong></summary>
            <p>
                The monitoring user needs at least:
            </p>
            <ul>
                <li>VIEW SERVER STATE permission</li>
                <li>VIEW DATABASE STATE permission</li>
                <li>db_owner role on the SQLWATCH database</li>
            </ul>
        </details>
        
        <details>
            <summary><strong>Q: How often is data collected?</strong></summary>
            <p>
                By default, data is collected every minute. You can adjust this in Settings 
                or configure SQL Agent jobs for custom collection intervals.
            </p>
        </details>
        
        <details>
            <summary><strong>Q: Can I monitor multiple servers from one dashboard?</strong></summary>
            <p>
                Yes! Use the Instance dropdown to select different servers, or select "All Instances" 
                to see aggregated data across all monitored servers.
            </p>
        </details>
        
        <details>
            <summary><strong>Q: How do I troubleshoot connection issues?</strong></summary>
            <p>
                1. Verify SQL Server is running and accessible<br/>
                2. Check firewall settings<br/>
                3. Ensure Trust Server Certificate is enabled in Settings (for encrypted connections)<br/>
                4. Verify authentication method matches your SQL Server configuration
            </p>
        </details>
        
        <details>
            <summary><strong>Q: Where is the data stored?</strong></summary>
            <p>
                Application settings are stored in appsettings.json and user-settings.json. 
                Dashboard cache is stored in SQLite (SqlHealthAssessment-cache.db). 
                Monitoring data is stored in the SQLWATCH database on your SQL Server.
            </p>
        </details>
    </div>

    <div class="about-section">
        <h2>‚å®Ô∏è Keyboard Shortcuts</h2>
        <p>Press <kbd>?</kbd> to show the shortcuts dialog, or use these quick keys:</p>
        <table class="shortcuts-table">
            <thead>
                <tr>
                    <th>Shortcut</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr><td><kbd>Ctrl+1-9</kbd></td><td>Navigate to dashboards 1-9</td></tr>
                <tr><td><kbd>Ctrl+H</kbd></td><td>Health Page</td></tr>
                <tr><td><kbd>Ctrl+Q</kbd></td><td>Quick Check</td></tr>
                <tr><td><kbd>Ctrl+E</kbd></td><td>Dashboard Editor</td></tr>
                <tr><td><kbd>Ctrl+S</kbd></td><td>Save (in editor)</td></tr>
                <tr><td><kbd>?</kbd></td><td>Show shortcuts help</td></tr>
                <tr><td><kbd>Esc</kbd></td><td>Close dialogs</td></tr>
            </tbody>
        </table>
    </div>

    <div class="about-section">
        <h2>üîß Configuration</h2>
        <p>Application settings are managed through environment-specific configuration files:</p>
        <ul>
            <li><strong>appsettings.json</strong> - Base configuration</li>
            <li><strong>appsettings.Development.json</strong> - Development overrides</li>
            <li><strong>appsettings.Production.json</strong> - Production overrides</li>
        </ul>
        <p>Key settings include query timeouts, cache limits, refresh intervals, and logging levels.</p>
    </div>

    <div class="about-section">
        <h2>üì¶ Deployment</h2>
        <p><strong>Build Type:</strong> Self-Contained Optimized</p>
        <ul>
            <li>No .NET Runtime required on target machines</li>
            <li>Single executable deployment</li>
            <li>ReadyToRun compilation for fast startup</li>
            <li>Compressed for optimal size (~100-120 MB)</li>
        </ul>
        <p>Check for updates in <strong>Settings ‚Üí Updates</strong></p>
    </div>

    <div class="about-section">
        <h2>üìû Support</h2>
        <p>
            For issues and feedback, please visit the project repository or contact the development team.
        </p>
    </div>

    <div class="about-actions">
        <button class="btn btn-primary" @onclick="GoToQuickCheck">
            ‚ö° Run Quick Check
        </button>
        <button class="btn btn-secondary" @onclick="GoToMonitoring">
            üî¨ Deploy Monitoring
        </button>
    </div>
</div>

@code {
    private void GoToQuickCheck()
    {
        Navigation.NavigateTo("/quickcheck");
    }

    private void GoToMonitoring()
    {
        Navigation.NavigateTo("/databasedeploy");
    }
}

<style>
    .about-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .about-container h1 {
        color: var(--text-primary);
        border-bottom: 3px solid var(--accent);
        padding-bottom: 10px;
        margin-bottom: 30px;
    }

    .about-section {
        margin-bottom: 35px;
        background: var(--bg-panel);
        padding: 20px;
        border-radius: 8px;
        border: 1px solid var(--border);
    }

    .about-section h2 {
        color: var(--accent);
        margin-top: 0;
    }

    .about-section h3 {
        color: var(--text-primary);
        margin-top: 20px;
    }

    .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 16px;
        margin-top: 16px;
    }

    .feature-card {
        background: var(--bg-secondary);
        padding: 16px;
        border-radius: 6px;
        border: 1px solid var(--border);
    }

    .feature-card h3 {
        margin-top: 0;
        font-size: 16px;
        color: var(--accent);
    }

    .feature-card ul {
        margin: 8px 0 0 0;
        padding-left: 20px;
        font-size: 13px;
        line-height: 1.8;
    }

    kbd {
        display: inline-block;
        padding: 3px 6px;
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 3px;
        font-family: 'Consolas', monospace;
        font-size: 11px;
        box-shadow: 0 1px 0 var(--border);
    }

    .about-section ol, .about-section ul {
        line-height: 1.8;
    }

    .alert {
        padding: 15px;
        border-radius: 4px;
        margin: 15px 0;
    }

    .alert-info {
        background: rgba(33, 150, 243, 0.1);
        border-left: 4px solid var(--accent);
        color: var(--text-primary);
    }

    .alert-warning {
        background: rgba(255, 152, 0, 0.1);
        border-left: 4px solid var(--orange);
        color: var(--text-primary);
    }

    details {
        margin: 10px 0;
        padding: 10px;
        background: var(--bg-secondary);
        border-radius: 4px;
        cursor: pointer;
        border: 1px solid var(--border);
    }

    details summary {
        font-weight: 600;
        color: var(--text-primary);
    }

    .dashboards-table, .shortcuts-table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
    }

    .dashboards-table th, .dashboards-table td,
    .shortcuts-table th, .shortcuts-table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid var(--border);
    }

    .dashboards-table th, .shortcuts-table th {
        background: var(--accent);
        color: white;
    }

    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.3s;
    }

    .btn-primary {
        background: var(--accent);
        color: white;
    }

    .btn-primary:hover {
        opacity: 0.9;
    }

    .btn-secondary {
        background: var(--green);
        color: white;
    }

    .btn-secondary:hover {
        opacity: 0.9;
    }
</style>
